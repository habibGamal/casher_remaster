var o=Object.defineProperty;var n=(i,t,e)=>t in i?o(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>(n(i,typeof t!="symbol"?t+"":t,e),e);import{M as c,N as p,D as l}from"./NoReturnOperations.df2eeaf5.js";import{x as u,v as s,b2 as h,j as m}from"./app.3aad4e87.js";import{C as d}from"./CreateInvoiceManager.55a1c683.js";import{h as y,f,d as b}from"./errorHandlers.e584f717.js";import"./PageTitle.30585599.js";import"./index.05831a02.js";import"./CheckOutlined.241343e2.js";import"./styleChecker.8ba932ef.js";import"./index.3e4aed6b.js";import"./index.39d1b77e.js";import"./mapEditableColumns.84f88b83.js";import"./index.4d07e239.js";import"./useSearch.9125f7ac.js";import"./SelectSearchUtils.f1a8e23b.js";import"./index.fe1d2ba1.js";import"./DeleteButton.5e9e11e4.js";import"./DeleteOutlined.043d105f.js";import"./index.d9a9a89c.js";import"./Table.611ad66a.js";import"./index.28850fea.js";import"./index.c383cf70.js";class S extends c{constructor(t){super(t),this.props=t}increaseItem(t,e){const r={...t};return r.quantity+=e,r.total=parseFloat((r.quantity*r.selling_price).toFixed(2)),r}validation(t){const e=t.quantity<=t.available_quantity;return e||u.error("\u0627\u0644\u0643\u0645\u064A\u0629 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0643\u0645\u064A\u0629 \u0627\u0644\u0645\u062A\u0627\u062D\u0629"),e}correctTotal(t){return{...t,total:parseFloat((t.selling_price*t.quantity).toFixed(2))}}}class I extends d{constructor(e){super();a(this,"search");a(this,"submit");a(this,"invoiceOperations");a(this,"returnInvoiceOperations");this.props=e,this.invoiceOperations=new S(e),this.returnInvoiceOperations=new p(null),this.afterSearch=this.afterSearch.bind(this),this.search=new v({attribute:this.props.search.data.attribute,value:this.props.search.data.value,stock_id:this.props.stockId},this.afterSearch),this.submit=new _(this.props)}afterSearch(e){this.invoiceOperations.add(e),this.props.search.changeSearchValue("")}}class v{constructor(t,e){a(this,"factory");this.searchParams=t,this.afterSearch=e,this.onSearch=this.onSearch.bind(this),this.factory=new g}onSearch(){s.Inertia.reload({data:this.searchParams,only:["product"],preserveState:!0,onSuccess:t=>{let e=t.props.product;if(y(e))return;if(e===null)return u.error("\u0627\u0644\u0645\u0646\u062A\u062C \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F");const r=this.factory.factory(e);this.afterSearch(r)}})}}class g{factory(t){return{key:t.id.toString(),id:t.id,name:t.name,barcode:t.barcode,buying_price:t.last_buying_price,selling_price:t.selling_price,available_quantity:t.available_quantity,quantity:1,total:t.selling_price}}}class _{constructor(t){this.props=t,this.onSubmit=this.onSubmit.bind(this)}remapItemsToSubmit(){return this.props.invoiceItems.map(t=>({product_id:t.id,quantity:t.quantity}))}onSubmit(){this.props.setLoading(!0),s.Inertia.post(h.storeURL(),{invoiceItems:this.remapItemsToSubmit(),stock_id:this.props.stockId},{onSuccess:t=>{this.props.setLoading(!1),f(t)||this.props.setInvoiceItems([])},onError:t=>{this.props.setLoading(!1),b(t)}})}}function G(){return m(l,{title:"\u0641\u0627\u062A\u0648\u0631\u0629 \u0628\u064A\u0639",defaultColumns:[{title:"\u0623\u0633\u0645 \u0627\u0644\u0635\u0646\u0641",dataIndex:"name",key:"name"},{title:"\u0643\u0648\u062F \u0627\u0644\u0635\u0646\u0641",dataIndex:"barcode",key:"barcode"},{title:"\u0633\u0639\u0631 \u0628\u064A\u0639 \u0627\u0644\u0648\u062D\u062F\u0629",dataIndex:"selling_price",key:"selling_price",editable:!0},{title:"\u0639\u062F\u062F \u0627\u0644\u0648\u062D\u062F\u0627\u062A",dataIndex:"quantity",key:"quantity",editable:!0},{title:"\u0627\u0644\u0627\u062C\u0645\u0627\u0644\u064A",dataIndex:"total",key:"total"}],getManager:I})}export{G as default};
