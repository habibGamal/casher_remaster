import{r as d,k as v,b8 as C,j as i,a as c,R as k,B as f,C as N}from"./app.3aad4e87.js";import{P as O}from"./PageTitle.30585599.js";import{m as T,E as A,a as D}from"./mapEditableColumns.84f88b83.js";import{u as M}from"./useSearch.9125f7ac.js";import{S as R,a as j}from"./SelectSearchUtils.f1a8e23b.js";import{D as B}from"./DeleteButton.5e9e11e4.js";import{D as p}from"./index.d9a9a89c.js";import{I as F}from"./index.3e4aed6b.js";import{S as P}from"./index.fe1d2ba1.js";import{T as _}from"./Table.611ad66a.js";function L(){d.exports.useEffect(()=>{const a=e=>{if(e.code!=="NumpadMultiply")return;e.preventDefault();const t=document.querySelector(".editable-quantity");t==null||t.click()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[])}function Y({title:a,defaultColumns:e,getManager:t}){const s={id:"search_product",defaultAttribute:"barcode",placeholder:"\u0627\u0644\u0645\u0646\u062A\u062C",options:[{label:"\u0627\u0644\u0627\u0633\u0645",value:"name"},{label:"\u0627\u0644\u0643\u0648\u062F",value:"barcode"}]},n=M(s.defaultAttribute),h=d.exports.useRef(null),[m,b]=v.useState([]),g=C().props.invoice_number,w={body:{row:A,cell:D}};L();const y=m.reduce((r,l)=>r+l.total,0),[u,S]=d.exports.useState(!1),[x,I]=v.useState(null),o=new t({invoiceItems:m,setInvoiceItems:b,stockId:x,setStockId:I,search:n,searchInputRef:h,loading:u,setLoading:S}),E=[...T(e,o.invoiceOperations.edit),{title:"\u062A\u062D\u0643\u0645",dataIndex:"operation",render:(r,l)=>i(B,{onClick:()=>{o.invoiceOperations.remove(l)}})}];return c(k,{gutter:[0,25],className:"m-8",children:[i(O,{name:a}),c("div",{className:"isolate-2 flex justify-between items-center w-full p-8 gap-8",children:[c(p,{className:"w-full",bordered:!0,children:[o.displayInvoiceNumber(g),i(p.Item,{label:"\u0627\u0644\u0627\u062C\u0645\u0627\u0644\u064A",children:y.toFixed(2)}),i(p.Item,{label:"\u0627\u0644\u0645\u062E\u0632\u0646",children:i(R,{name:"stock_id",style:{width:"12rem"},onSearch:j.getStocks,onChange:r=>I(r)})})]}),i(f,{loading:u,onClick:o.submit.onSubmit,type:"primary",children:o.actionBtnTitle()})]}),c(N,{span:"24",className:"isolate",children:[c("div",{className:"flex gap-6 mb-6",children:[i(F,{id:s.id,ref:h,allowClear:!0,addonBefore:i(P,{defaultValue:n.data.attribute,onChange:n.changeSearchAttribute,options:s.options}),placeholder:s.placeholder,className:"placeholder:font-tajawal",value:n.data.value,onChange:r=>{n.changeSearchValue(r.target.value)},onPressEnter:o.search.onSearch}),i(f,{onClick:o.invoiceOperations.cancelOperation,className:"mx-auto",danger:!0,type:"primary",children:"\u0627\u0644\u063A\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064A\u0629"})]}),i(_,{components:w,rowClassName:()=>"editable-row",columns:E,rowKey:r=>r.key.toString(),dataSource:o.invoiceOperations.getInvoiceItems(),pagination:!1,loading:u,bordered:!0,scroll:{x:!0}})]})]})}class Z{constructor(e){this.props=e,this.add=this.add.bind(this),this.edit=this.edit.bind(this),this.remove=this.remove.bind(this),this.cancelOperation=this.cancelOperation.bind(this),this.getInvoiceItems=this.getInvoiceItems.bind(this)}addToExistingItem(e){const t=this.props.invoiceItems.map(s=>s.id===e.id?this.increaseItem(s,1):s);this.props.setInvoiceItems(t)}searchFocus(){const e=setTimeout(()=>{var t;(t=this.props.searchInputRef.current)==null||t.focus(),clearTimeout(e)},0)}getInvoiceItems(){return this.props.invoiceItems}add(e){if(!this.validation(e))return;if(this.props.invoiceItems.find(s=>s.id==e.id))return this.addToExistingItem(e);this.props.setInvoiceItems([e,...this.props.invoiceItems])}edit(e){if(!this.validation(e))return;const t=this.props.invoiceItems.map(s=>s.id===e.id?this.correctTotal(e):s);this.props.setInvoiceItems(t),this.searchFocus()}remove(e){console.log(e),this.props.setInvoiceItems(this.props.invoiceItems.filter(t=>t.key!==e.key))}cancelOperation(){this.props.setInvoiceItems([])}}class ${constructor(e){this.props=e,this.edit=this.edit.bind(this),this.cancelOperation=this.cancelOperation.bind(this),this.getInvoiceItems=this.getInvoiceItems.bind(this)}getInvoiceItems(){throw new Error("This type of Invoice does not support this operation")}edit(){throw new Error("This type of Invoice does not support this operation")}cancelOperation(){throw new Error("This type of Invoice does not support this operation")}}export{Y as D,Z as M,$ as N};
