var R=Object.defineProperty;var _=(r,e,t)=>e in r?R(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>(_(r,typeof e!="symbol"?e+"":e,t),t);import{r as i,j as d,A as z,_ as b,a as M,B as N,b8 as j,ao as x,ap as C,b9 as T}from"./app.3aad4e87.js";import{S as k}from"./index.3e4aed6b.js";import{F as V}from"./index.4d07e239.js";import{S as H}from"./index.fe1d2ba1.js";import{u as G,M as P}from"./useLoading.7900d1a7.js";import{T as K}from"./Table.611ad66a.js";var $={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"};const U=$;var v=function(e,t){return d(z,{...b(b({},e),{},{ref:t,icon:U})})};v.displayName="PlusCircleOutlined";const W=i.exports.forwardRef(v);function q({options:r,defaultValue:e,addButtonText:t,addButtonAction:o,searchButtonAction:l,setSearch:n,setAttribute:a,exitSearchMode:c}){return M(V,{className:"flex gap-6 mb-6",children:[d(k,{allowClear:!0,addonBefore:r&&d(H,{defaultValue:e,onChange:s=>a(s),options:r}),placeholder:"\u0628\u062D\u062B",className:"placeholder:font-tajawal",onChange:s=>{n(s.target.value),s.target.value?l():c()},enterButton:!0}),t&&M(N,{type:"primary",icon:d(W,{}),onClick:o,children:[" ",t," "]})]})}const J=r=>{const[e,t]=i.exports.useState(""),[o,l]=i.exports.useState(r),[n,a]=i.exports.useState(!1);return{search:e,setSearch:t,attribute:o,setAttribute:l,exitSearchMode:()=>a(!1),enterSearchMode:()=>a(!0),searchMode:n}},Q=J,X=r=>{const[e,t]=i.exports.useState({order:null,columnKey:r}),o=a=>{if(e.order==="descend"){t({order:"ascend",columnKey:a});return}if(e.order==="ascend"){t({order:null,columnKey:a});return}e.order===null&&t({order:"descend",columnKey:a})};return{getSortProps:a=>({sorter:!0,sortOrder:e.columnKey===a?e.order:null,onHeaderCell:()=>({onClick:()=>{o(a)}}),sortDirections:["descend","ascend"]}),resetSortState:()=>{t({order:null,columnKey:void 0})}}},Y=(r=1,e=10)=>{const[t,o]=i.exports.useState({pagination:{current:r,pageSize:e}});return{tableParams:t,setTableParams:o,updateTableParams:(a,c,s)=>{o({pagination:a,filters:c,...s})},resetPagination:()=>{o(a=>({...a,pagination:{...a.pagination,current:1}}))}}};function Z(r){var t;let e=r.order;return e==="ascend"&&(e="asc"),e==="descend"&&(e="desc"),{order:e!=null?e:null,columnKey:(t=r.columnKey)!=null?t:null}}const ee=325,te=(r,e,t)=>{i.exports.useEffect(()=>{let o=null;return e&&(o=setTimeout(()=>{r()},ee)),()=>{o!==null&&clearTimeout(o)}},[...t])};class de{constructor(e,t){g(this,"config");g(this,"ctx");this.ModelForm=t,this.config=e,this.ctx=i.exports.createContext({config:this.config}),this.TableController=this.TableController.bind(this),this.FreeModal=this.FreeModal.bind(this),this.ModalForm=this.ModalForm.bind(this),this.ModelTable=this.ModelTable.bind(this),this.Ctx=this.Ctx.bind(this)}Ctx({children:e}){var f,m;const t=j().props[this.config.slug],o=Q(this.config.search.defaultValue),l=x(),n=x(),[a,c]=i.exports.useState({children:null,onClose:void 0,title:""}),s=G(),u=X("created_at"),[F,w]=i.exports.useState(void 0),p=new URLSearchParams(window.location.search),O=(f=p.get(this.config.slug+"_page"))!=null?f:"1",A=(m=p.get(this.config.slug+"_pageSize"))!=null?m:"10",{tableParams:D,updateTableParams:B,resetPagination:I}=Y(parseInt(O),parseInt(A)),E=(h,L,S)=>{B(h,L,S);const y=Z(S);P.setTableGlobalSettings({page:h.current,pageSize:h.pageSize,sortInfo:y,stateLoading:s.stateLoading,search:o.search,attribute:o.attribute}).updateTableData(this.config.slug)};return d(this.ctx.Provider,{value:{config:this.config,search:o,modalForm:l,freeModal:n,freeModalSettings:a,setFreeModalSettings:c,tableState:s,sortingArrows:u,tableParams:D,resetPagination:I,handleTableChange:E,paginatedData:t,modelToEdit:F,setModelToEdit:w},children:e})}FreeModal(){var o,l;const e=i.exports.useContext(this.ctx),t=()=>{var n;(n=e.freeModalSettings)!=null&&n.onClose&&e.freeModalSettings.onClose(),e.freeModal.handleCancel()};return d(C,{title:(o=e.freeModalSettings)==null?void 0:o.title,open:e.freeModal.open,onOk:e.freeModal.handleOk,footer:null,confirmLoading:e.freeModal.confirmLoading,onCancel:t,destroyOnClose:!0,width:"90%",closeIcon:d(T,{icon:"add",className:"rotate-45"}),children:(l=e.freeModalSettings)==null?void 0:l.children})}ModalForm(){const e=i.exports.useContext(this.ctx);return d(C,{title:e.config.addButton,open:e.modalForm.open,onOk:e.modalForm.handleOk,footer:null,confirmLoading:e.modalForm.confirmLoading,onCancel:e.modalForm.handleCancel,destroyOnClose:!0,width:"90%",closeIcon:d(T,{icon:"add",className:"rotate-45"}),children:this.ModelForm&&d(this.ModelForm,{modelToEdit:e.modelToEdit,closeModal:e.modalForm.closeModal})})}TableController(){const e=i.exports.useContext(this.ctx);te(()=>{e.resetPagination(),e.sortingArrows.resetSortState(),P.setTableGlobalSettings({stateLoading:e.tableState.stateLoading,search:e.search.search,attribute:e.search.attribute}).updateTableData(e.config.slug)},e.search.searchMode,[e.search.searchMode,e.search.search,e.search.attribute]);const t=()=>{e.setModelToEdit(void 0),e.modalForm.showModal()};return d(q,{addButtonText:e.config.addButton,addButtonAction:t,searchButtonAction:()=>{var o;return(o=e.search)==null?void 0:o.enterSearchMode()},setSearch:e.search.setSearch,setAttribute:e.search.setAttribute,exitSearchMode:()=>{e.config.exitSearchMode(e)},defaultValue:e.config.search.defaultValue,options:e.config.search.options})}mappingColumns(e,t){return e.map(({title:o,dataIndex:l,key:n,sorting:a,render:c,renderWithCtx:s})=>{s&&(c=s(t));let u={title:o,dataIndex:l,key:n,render:c};return a&&(u={...u,...t.sortingArrows.getSortProps(n)}),u})}ModelTable(){var a,c;const e=i.exports.useContext(this.ctx),t=(a=e.paginatedData)==null?void 0:a.data,o=e.config.reshapeData,l=o?o(t):t,n=this.mappingColumns(e.config.modelColumns,e);return d(K,{columns:n,rowKey:s=>s.id,dataSource:l,pagination:{...e.tableParams.pagination,total:(c=e.paginatedData)==null?void 0:c.total},expandable:{expandedRowRender:e.config.expandedRowRender,rowExpandable:s=>s.name!=="Not Expandable"},loading:e.tableState.loading,bordered:!0,onChange:e.handleTableChange,scroll:{x:!0},footer:()=>{var s,u;return"\u0639\u062F\u062F \u0627\u0644\u0646\u062A\u0627\u0626\u062C : "+(((s=e.paginatedData)==null?void 0:s.total)===void 0?0:(u=e.paginatedData)==null?void 0:u.total)}})}}export{de as M,Q as u};
